import{r as g,u as N,j as e,c as E,b as k,i as I,e as F,l as w}from"./index-BymzTkb0.js";const A=()=>{const{preflightResult:a,view:i,handleAnalysis:h,resetAnalysis:m,preflightError:c}=N(),{initializeChat:j}=E(),u=i==="loading",{showError:x}=k();return g.useEffect(()=>{c&&x(c,"error")},[c,x]),c?e.jsxs("div",{className:"preflight-check-view text-center",children:[e.jsx("p",{className:"text-lg text-red",children:"Pre-Flight Check Failed. Please try again or check your PoB code/URL."}),e.jsx("h4",{className:"text-lg text-red",children:"Pre-Flight Check Failed"}),e.jsx("p",{className:"opacity-90 mt-2",children:c}),e.jsx("button",{onClick:m,className:"button button-secondary mt-4",children:"Try Again"})]}):a?e.jsxs("div",{className:"preflight-check-view animate-fade-in text-center",children:[e.jsx("p",{children:"Build Identified. Confirm and analyze the character."}),e.jsx("h4",{className:"text-lg text-green",children:"Build Identified"}),e.jsx("p",{className:"opacity-70 mt-1",children:"The AI has identified the following character. Does this look correct?"}),e.jsxs("ul",{className:"preflight-list",children:[e.jsxs("li",{children:[e.jsx("span",{className:"label",children:"Level:"})," ",e.jsx("span",{className:"value",children:a.level})]}),e.jsxs("li",{children:[e.jsx("span",{className:"label",children:"Class:"})," ",e.jsx("span",{className:"value",children:a.characterClass})]}),e.jsxs("li",{children:[e.jsx("span",{className:"label",children:"Ascendancy:"})," ",e.jsx("span",{className:"value",children:a.ascendancy})]}),e.jsxs("li",{children:[e.jsx("span",{className:"label",children:"Main Skill:"})," ",e.jsx("span",{className:"value",children:a.mainSkill})]})]}),e.jsxs("div",{className:"flex-row gap-4 justify-center mt-6",children:[e.jsx("button",{onClick:m,disabled:u,className:"button button-secondary",children:"Cancel"}),e.jsxs("button",{onClick:()=>h(j),disabled:u,className:"button button-primary",children:[e.jsx("span",{children:"Confirm and analyze the character."}),"Confirm & Analyze"]})]})]}):e.jsxs("div",{className:"flex-col items-center justify-center",style:{height:"12rem"},children:[e.jsx("p",{children:"Running Pre-Flight Check..."}),e.jsx("p",{className:"text-yellow mt-4",children:"Running Pre-Flight Check..."})]})},R=()=>{const{accountName:a,setAccountName:i,characters:h,isFetchingCharacters:m,handleFetchCharacters:c,handleSelectCharacter:j,resetImport:u,isFetchingPobData:x,selectedCharacter:p,handleCharacterAnalysis:b,error:n}=N(),{showError:l}=k(),r=m||x,[t,f]=g.useState(!1),[o,C]=g.useState(()=>{try{return localStorage.getItem("poe-sessid")||""}catch{return""}}),[S,v]=g.useState(""),d=s=>{try{const P=document.cookie.match(new RegExp("(?:^|;\\s*)"+s+"=([^;]+)"));return P?decodeURIComponent(P[1]):null}catch{return null}},y=()=>{try{if(!o.trim()){document.cookie="POESESSID=; path=/; max-age=0";try{localStorage.removeItem("poe-sessid")}catch{}v("Cleared"),l("Cleared POESESSID from this app session.","info");return}document.cookie=`POESESSID=${encodeURIComponent(o.trim())}; path=/; max-age=2592000`;try{localStorage.setItem("poe-sessid",o.trim())}catch{}v("Saved"),l("POESESSID saved for this app domain. Try FETCH again.","info")}catch{v("Error"),l("Could not set POESESSID cookie. Try manual import or check browser settings.","error")}};return g.useEffect(()=>{n&&l(n,"error")},[n,l]),x?e.jsxs("div",{className:"flex-col items-center justify-center",style:{height:"12rem"},children:[e.jsx("p",{children:"Fetching build data from PoE account."}),e.jsx("p",{className:"text-yellow mt-4",children:"Fetching build data..."})]}):p?e.jsxs("div",{className:"text-center flex-col gap-4",style:{backgroundColor:"rgba(0,0,0,0.2)",padding:"1.5rem",borderRadius:"8px",border:"1px solid var(--color-divider)"},children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg text-green",children:"Character Selected"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:p.name}),e.jsxs("p",{className:"opacity-70",children:["Level ",p.level," ",p.class]})]}),e.jsx("div",{className:"pt-4",style:{borderTop:"1px solid var(--color-divider)"},children:e.jsx("button",{onClick:()=>b(a,p.name),disabled:r,className:"button button-primary w-full",children:r?"Fetching build data...":e.jsx("span",{children:"Fetch Build & Run Pre-Flight"})})}),e.jsx("button",{onClick:u,disabled:r,className:"chromatic-aberration mt-4 text-sm text-sky",style:{background:"none",border:"none",cursor:"pointer",opacity:r?.5:1},children:"Import another character or account"})]}):m?e.jsxs("div",{className:"flex-col items-center justify-center",style:{height:"12rem"},children:[e.jsx("p",{children:"Fetching characters from PoE account."}),e.jsx("p",{className:"text-yellow mt-4",children:"Fetching characters..."})]}):h.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-yellow mb-2",children:"Select a Character"}),e.jsx("div",{className:"flex-col gap-2",children:h.map(s=>e.jsx("button",{onClick:()=>j(s),className:"button button-secondary",style:{textAlign:"left",width:"100%",justifyContent:"flex-start"},children:e.jsxs("div",{style:{flexGrow:1},children:[e.jsx("p",{className:"font-bold",children:s.name}),e.jsxs("p",{className:"text-sm opacity-70",children:["Level ",s.level," ",s.class]})]})},s.name))}),e.jsx("button",{onClick:u,disabled:r,className:"chromatic-aberration mt-4 text-sm text-sky",style:{background:"none",border:"none",cursor:"pointer",opacity:r?.5:1},children:"Back"})]}):e.jsx("div",{className:"flex-col gap-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"account-name",className:"block text-lg text-yellow mb-2",children:"PoE Account Handle"}),e.jsxs("p",{className:"text-sm opacity-70 mb-4",children:["Enter your full handle including the discriminator. Example: ",e.jsx("code",{children:"Hettii#6037"}),". Your profile must be set to public on pathofexile.com."]}),e.jsxs("div",{className:"flex-row gap-2",children:[e.jsx("input",{id:"account-name",type:"text",className:"input-field",style:{flexGrow:1},placeholder:"e.g., Hettii#6037",value:a,onChange:s=>i(s.target.value),disabled:r,onKeyDown:s=>s.key==="Enter"&&c()}),e.jsx("button",{onClick:c,disabled:r||!a.trim(),className:"button button-primary",style:{padding:"0.5rem 1rem"},children:"FETCH"})]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>f(s=>!s),className:"chromatic-aberration text-sm text-sky",style:{background:"none",border:"none",cursor:"pointer"},children:t?"Hide Advanced":"Advanced"})}),t&&e.jsxs("div",{className:"mt-2 p-3",style:{backgroundColor:"rgba(0,0,0,0.2)",borderRadius:"6px",border:"1px solid var(--color-divider)"},children:[e.jsxs("p",{className:"text-sm opacity-70 mb-2",children:["Optional: paste your ",e.jsx("code",{children:"POESESSID"})," (session cookie) if PoE still blocks public API requests in your region. Paste to enable private/gated character fetching. Leave empty and click Save to clear."]}),e.jsxs("div",{className:"flex-row gap-2",children:[e.jsx("input",{type:"password",className:"input-field",placeholder:"POESESSID value",value:o,onChange:s=>C(s.target.value),style:{flexGrow:1},autoComplete:"off"}),e.jsx("button",{onClick:y,className:"button button-secondary",style:{padding:"0.5rem 1rem"},children:"Save"})]}),e.jsxs("div",{className:"text-sm mt-2 opacity-70",children:["Status: ",S||(d("POESESSID")?"Detected":"Not set")]})]})]})})},L=()=>{const{pobInput:a,setPobInput:i,pobUrl:h,setPobUrl:m,view:c,handlePreflightCheck:j,preflightResult:u,isPreflighting:x,preflightError:p}=N(),b=c==="loading",n=!!(x||u||p),[l,r]=g.useState(a),[t,f]=g.useState({status:"idle",message:""}),{showError:o}=k();g.useEffect(()=>{const d=setTimeout(()=>{const y=l.trim();if(!y){f({status:"idle",message:""}),a&&i("");return}if(f({status:"validating",message:""}),I(y))try{const s=F(y);i(s),f({status:"valid",message:""}),o("PoB code decoded successfully.","info")}catch(s){i(""),f({status:"invalid",message:""}),o(s.message,"error")}else y.startsWith("<")?(i(y),f({status:"valid",message:""}),o("XML data recognized.","info")):(i(""),f({status:"invalid",message:""}),o("Invalid format. Paste a PoB code or full XML.","error"))},500);return()=>clearTimeout(d)},[l,i,a,o]);const C=async()=>{try{const d=await navigator.clipboard.readText();r(d),w.info("Pasted PoB data from clipboard.")}catch(d){w.error("Failed to read clipboard contents.",{error:d}),o("Could not read from clipboard. Please paste manually or ensure clipboard access is granted.","error")}},S=()=>t.status==="valid"?"var(--color-green)":t.status==="invalid"?"var(--color-red)":"var(--color-glow-secondary)",v=t.status==="valid"&&h.trim().length>10;return e.jsxs("div",{className:"flex-col gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex-row justify-between items-center mb-2",children:[e.jsx("label",{htmlFor:"pob-input",className:"block text-lg text-yellow",children:"Step 1: Path of Building Data"}),e.jsx("button",{onClick:C,disabled:b||n,className:"button button-secondary",style:{padding:"0.25rem 0.75rem",fontSize:"0.75rem",color:"#fff"},"aria-label":"Paste",children:"PASTE"})]}),e.jsx("p",{className:"text-sm opacity-70 mb-4",children:'In PoB, go to Import/Export Build, click "Generate", and copy the code. You can paste the code or the full XML.'}),e.jsx("textarea",{id:"pob-input",className:"textarea-field",style:{height:"8rem",borderColor:S()},placeholder:"Paste your PoB code or full XML export here...",value:l,onChange:d=>r(d.target.value),disabled:b||n})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pob-url",className:"block text-lg text-yellow mb-2",children:"Step 2: Public Build URL"}),e.jsxs("p",{className:"text-sm opacity-70 mb-4",children:["Share your build to a site like ",e.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"0.1rem 0.3rem",borderRadius:"4px"},children:"pobb.in"})," and paste the URL."]}),e.jsx("input",{id:"pob-url",type:"url",className:"input-field",placeholder:"e.g., https://pobb.in/...",value:h,onChange:d=>m(d.target.value),disabled:b||n})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dashed border-[var(--color-divider)]",children:[e.jsx("p",{className:"text-center text-sm opacity-70 mb-4",children:"Adjust context below, then run the pre-flight check to continue."}),e.jsxs("button",{onClick:()=>j(a),disabled:!v||b||n,className:"button button-primary w-full",children:[e.jsx("span",{children:"Run the pre-flight check to analyze the character."}),e.jsx("span",{children:"Run Pre-Flight Check"})]})]})]})},D=()=>{const[a,i]=g.useState("account"),{view:h,leagueContext:m,setLeagueContext:c,analysisGoal:j,setAnalysisGoal:u,isPreflighting:x,preflightResult:p,preflightError:b}=N(),n=h==="loading",l=!!(x||p||b),r=[{id:"account",label:"Import from Account"},{id:"manual",label:"Import Manually"}];return e.jsxs("div",{className:"card p-6 flex-col gap-6",children:[e.jsx("div",{className:"tabs",role:"tablist","aria-label":"Import Method",children:r.map(t=>e.jsx("button",{id:`tab-${t.id}`,role:"tab","aria-selected":a===t.id,"aria-controls":"import-panel",onClick:()=>i(t.id),className:`tab-button ${a===t.id?"active":""}`,disabled:l,children:t.label},t.id))}),e.jsx("div",{id:"import-panel",role:"tabpanel","aria-labelledby":`tab-${a}`,className:"pt-4",children:l?e.jsx(A,{}):a==="account"?e.jsx(R,{}):e.jsx(L,{})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block mb-2",children:"Select the league context for the character."}),e.jsx("div",{className:"segmented-toggle",role:"group","aria-label":"League Context",children:["League Start","Mid-League","Endgame"].map(t=>e.jsx("button",{type:"button",className:`toggle-option ${m===t?"active":""}`,onClick:()=>c(t),disabled:n||l,children:e.jsx("span",{children:t})},t))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block mb-2",children:"Select the analysis goal for the character."}),e.jsx("div",{className:"segmented-toggle",role:"group","aria-label":"Analysis Goal",children:["All-Rounder","Mapping","Bossing"].map(t=>e.jsx("button",{type:"button",className:`toggle-option ${j===t?"active":""}`,onClick:()=>u(t),disabled:n||l,children:e.jsx("span",{children:t})},t))})]})]})]})};export{D as default};
