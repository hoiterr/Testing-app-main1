import{r as j,u as y,j as e,c as F,b as N,i as S,e as I,l as C}from"./index-DHWOAx-T.js";const B=()=>{const{preflightResult:s,view:l,handleAnalysis:c,resetAnalysis:o,preflightError:r}=y(),{initializeChat:p}=F(),d=l==="loading",{showError:h}=N();return j.useEffect(()=>{r&&h(r,"error")},[r,h]),r?e.jsxs("div",{className:"preflight-check-view text-center",children:[e.jsx("p",{className:"text-lg text-red",children:"Pre-Flight Check Failed. Please try again or check your PoB code/URL."}),e.jsx("h4",{className:"text-lg text-red",children:"Pre-Flight Check Failed"}),e.jsx("p",{className:"opacity-90 mt-2",children:r}),e.jsx("button",{onClick:o,className:"button button-secondary mt-4",children:"Try Again"})]}):s?e.jsxs("div",{className:"preflight-check-view animate-fade-in text-center",children:[e.jsx("p",{children:"Build Identified. Confirm and analyze the character."}),e.jsx("h4",{className:"text-lg text-green",children:"Build Identified"}),e.jsx("p",{className:"opacity-70 mt-1",children:"The AI has identified the following character. Does this look correct?"}),e.jsxs("ul",{className:"preflight-list",children:[e.jsxs("li",{children:[e.jsx("span",{className:"label",children:"Level:"})," ",e.jsx("span",{className:"value",children:s.level})]}),e.jsxs("li",{children:[e.jsx("span",{className:"label",children:"Class:"})," ",e.jsx("span",{className:"value",children:s.characterClass})]}),e.jsxs("li",{children:[e.jsx("span",{className:"label",children:"Ascendancy:"})," ",e.jsx("span",{className:"value",children:s.ascendancy})]}),e.jsxs("li",{children:[e.jsx("span",{className:"label",children:"Main Skill:"})," ",e.jsx("span",{className:"value",children:s.mainSkill})]})]}),e.jsxs("div",{className:"flex-row gap-4 justify-center mt-6",children:[e.jsx("button",{onClick:o,disabled:d,className:"button button-secondary",children:"Cancel"}),e.jsxs("button",{onClick:()=>c(p),disabled:d,className:"button button-primary",children:[e.jsx("span",{children:"Confirm and analyze the character."}),"Confirm & Analyze"]})]})]}):e.jsxs("div",{className:"flex-col items-center justify-center",style:{height:"12rem"},children:[e.jsx("p",{children:"Running Pre-Flight Check..."}),e.jsx("p",{className:"text-yellow mt-4",children:"Running Pre-Flight Check..."})]})},E=()=>{const{accountName:s,setAccountName:l,characters:c,isFetchingCharacters:o,handleFetchCharacters:r,handleSelectCharacter:p,resetImport:d,isFetchingPobData:h,selectedCharacter:u,handleCharacterAnalysis:m,error:i}=y(),{showError:n}=N(),a=o||h;return j.useEffect(()=>{i&&n(i,"error")},[i,n]),h?e.jsxs("div",{className:"flex-col items-center justify-center",style:{height:"12rem"},children:[e.jsx("p",{children:"Fetching build data from PoE account."}),e.jsx("p",{className:"text-yellow mt-4",children:"Fetching build data..."})]}):u?e.jsxs("div",{className:"text-center flex-col gap-4",style:{backgroundColor:"rgba(0,0,0,0.2)",padding:"1.5rem",borderRadius:"8px",border:"1px solid var(--color-divider)"},children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg text-green",children:"Character Selected"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:u.name}),e.jsxs("p",{className:"opacity-70",children:["Level ",u.level," ",u.class]})]}),e.jsx("div",{className:"pt-4",style:{borderTop:"1px solid var(--color-divider)"},children:e.jsx("button",{onClick:()=>m(s,u.name),disabled:a,className:"button button-primary w-full",children:a?"Fetching build data...":e.jsx("span",{children:"Fetch Build & Run Pre-Flight"})})}),e.jsx("button",{onClick:d,disabled:a,className:"chromatic-aberration mt-4 text-sm text-sky",style:{background:"none",border:"none",cursor:"pointer",opacity:a?.5:1},children:"Import another character or account"})]}):o?e.jsxs("div",{className:"flex-col items-center justify-center",style:{height:"12rem"},children:[e.jsx("p",{children:"Fetching characters from PoE account."}),e.jsx("p",{className:"text-yellow mt-4",children:"Fetching characters..."})]}):c.length>0?e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-yellow mb-2",children:"Select a Character"}),e.jsx("div",{className:"flex-col gap-2",children:c.map(t=>e.jsx("button",{onClick:()=>p(t),className:"button button-secondary",style:{textAlign:"left",width:"100%",justifyContent:"flex-start"},children:e.jsxs("div",{style:{flexGrow:1},children:[e.jsx("p",{className:"font-bold",children:t.name}),e.jsxs("p",{className:"text-sm opacity-70",children:["Level ",t.level," ",t.class]})]})},t.name))}),e.jsx("button",{onClick:d,disabled:a,className:"chromatic-aberration mt-4 text-sm text-sky",style:{background:"none",border:"none",cursor:"pointer",opacity:a?.5:1},children:"Back"})]}):e.jsx("div",{className:"flex-col gap-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"account-name",className:"block text-lg text-yellow mb-2",children:"PoE Account Name"}),e.jsx("p",{className:"text-sm opacity-70 mb-4",children:"Enter your account name. Your profile must be set to public on pathofexile.com."}),e.jsxs("div",{className:"flex-row gap-2",children:[e.jsx("input",{id:"account-name",type:"text",className:"input-field",style:{flexGrow:1},placeholder:"YourAccountName",value:s,onChange:t=>l(t.target.value),disabled:a,onKeyDown:t=>t.key==="Enter"&&r()}),e.jsx("button",{onClick:r,disabled:a||!s.trim(),className:"button text-black",style:{backgroundColor:"var(--color-sky)"},children:"Fetch"})]})]})})},A=()=>{const{pobInput:s,setPobInput:l,pobUrl:c,setPobUrl:o,view:r,handlePreflightCheck:p,preflightResult:d,isPreflighting:h,preflightError:u}=y(),m=r==="loading",i=!!(h||d||u),[n,a]=j.useState(s),[t,b]=j.useState({status:"idle",message:""}),{showError:g}=N();j.useEffect(()=>{const x=setTimeout(()=>{const f=n.trim();if(!f){b({status:"idle",message:""}),s&&l("");return}if(b({status:"validating",message:""}),S(f))try{const v=I(f);l(v),b({status:"valid",message:""}),g("PoB code decoded successfully.","info")}catch(v){l(""),b({status:"invalid",message:""}),g(v.message,"error")}else f.startsWith("<")?(l(f),b({status:"valid",message:""}),g("XML data recognized.","info")):(l(""),b({status:"invalid",message:""}),g("Invalid format. Paste a PoB code or full XML.","error"))},500);return()=>clearTimeout(x)},[n,l,s,g]);const k=async()=>{try{const x=await navigator.clipboard.readText();a(x),C.info("Pasted PoB data from clipboard.")}catch(x){C.error("Failed to read clipboard contents.",{error:x}),g("Could not read from clipboard. Please paste manually or ensure clipboard access is granted.","error")}},w=()=>t.status==="valid"?"var(--color-green)":t.status==="invalid"?"var(--color-red)":"var(--color-glow-secondary)",P=t.status==="valid"&&c.trim().length>10;return e.jsxs("div",{className:"flex-col gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex-row justify-between items-center mb-2",children:[e.jsx("label",{htmlFor:"pob-input",className:"block text-lg text-yellow",children:"Step 1: Path of Building Data"}),e.jsxs("button",{onClick:k,disabled:m||i,className:"button button-secondary",style:{padding:"0.25rem 0.75rem",fontSize:"0.75rem"},children:[e.jsx("span",{children:"Paste your Path of Building pastebin link or import code here."}),e.jsx("span",{children:"Paste"})]})]}),e.jsx("p",{className:"text-sm opacity-70 mb-4",children:'In PoB, go to Import/Export Build, click "Generate", and copy the code. You can paste the code or the full XML.'}),e.jsx("textarea",{id:"pob-input",className:"textarea-field",style:{height:"8rem",borderColor:w()},placeholder:"Paste your PoB code or full XML export here...",value:n,onChange:x=>a(x.target.value),disabled:m||i})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pob-url",className:"block text-lg text-yellow mb-2",children:"Step 2: Public Build URL"}),e.jsxs("p",{className:"text-sm opacity-70 mb-4",children:["Share your build to a site like ",e.jsx("code",{style:{background:"rgba(0,0,0,0.3)",padding:"0.1rem 0.3rem",borderRadius:"4px"},children:"pobb.in"})," and paste the URL."]}),e.jsx("input",{id:"pob-url",type:"url",className:"input-field",placeholder:"e.g., https://pobb.in/...",value:c,onChange:x=>o(x.target.value),disabled:m||i})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-dashed border-[var(--color-divider)]",children:[e.jsx("p",{className:"text-center text-sm opacity-70 mb-4",children:"Adjust context below, then run the pre-flight check to continue."}),e.jsxs("button",{onClick:()=>p(s),disabled:!P||m||i,className:"button button-primary w-full",children:[e.jsx("span",{children:"Run the pre-flight check to analyze the character."}),e.jsx("span",{children:"Run Pre-Flight Check"})]})]})]})},L=()=>{const[s,l]=j.useState("account"),{view:c,leagueContext:o,setLeagueContext:r,analysisGoal:p,setAnalysisGoal:d,isPreflighting:h,preflightResult:u,preflightError:m}=y(),i=c==="loading",n=!!(h||u||m),a=[{id:"account",label:"Import from Account"},{id:"manual",label:"Import Manually"}];return e.jsxs("div",{className:"card p-6 flex-col gap-6",children:[e.jsx("div",{className:"tabs",role:"tablist","aria-label":"Import Method",children:a.map(t=>e.jsx("button",{id:`tab-${t.id}`,role:"tab","aria-selected":s===t.id,"aria-controls":"import-panel",onClick:()=>l(t.id),className:`tab-button ${s===t.id?"active":""}`,disabled:n,children:t.label},t.id))}),e.jsx("div",{id:"import-panel",role:"tabpanel","aria-labelledby":`tab-${s}`,className:"pt-4",children:n?e.jsx(B,{}):s==="account"?e.jsx(E,{}):e.jsx(A,{})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("span",{children:"Select the league context for the character."}),e.jsx("label",{htmlFor:"league-context",className:"block text-lg text-yellow mb-2",children:"League Context:"}),e.jsxs("select",{id:"league-context",className:"input-field",value:o,onChange:t=>r(t.target.value),disabled:i||n,children:[e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Hardcore",children:"Hardcore"}),e.jsx("option",{value:"SSF",children:"SSF"}),e.jsx("option",{value:"HCSSF",children:"HCSSF"})]})]}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("span",{children:"Select the analysis goal for the character."}),e.jsx("label",{htmlFor:"analysis-goal",className:"block text-lg text-yellow mb-2",children:"Analysis Goal:"}),e.jsxs("select",{id:"analysis-goal",className:"input-field",value:p,onChange:t=>d(t.target.value),disabled:i||n,children:[e.jsx("option",{value:"Build",children:"Build"}),e.jsx("option",{value:"Item",children:"Item"}),e.jsx("option",{value:"Passive",children:"Passive"}),e.jsx("option",{value:"Skill",children:"Skill"})]})]})]})]})};export{L as default};
